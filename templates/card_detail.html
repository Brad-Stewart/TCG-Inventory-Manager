{% extends "base.html" %}

{% block title %}{{ card.card_name }} - TCG Inventory{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <div class="card-image-container">
            {% if card.image_url %}
            <img id="cardImageFront" src="{{ card.image_url }}" class="img-fluid rounded" alt="{{ card.card_name }}" style="cursor: pointer;">
            
            {% if card.image_url_back %}
            <!-- Back side image (hidden by default) -->
            <img id="cardImageBack" src="{{ card.image_url_back }}" class="img-fluid rounded" alt="{{ card.card_name }} (Back)" 
                 style="display: none; cursor: pointer;">
            
            <!-- Flip button for double-faced cards -->
            <div class="mt-2 text-center">
                <button id="flipCardBtn" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-sync-alt"></i> <span id="flipText">Show Back</span>
                </button>
                <div class="form-text">Double-faced card - click to flip</div>
            </div>
            {% endif %}
            
            {% else %}
            <div class="bg-light rounded p-5 text-center">
                <i class="fas fa-image fa-3x text-muted"></i>
                <p class="text-muted mt-2">No image available</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                <h2>{{ card.card_name }}</h2>
                <p class="text-muted">{{ card.set_name }} ({{ card.set_code }})</p>
            </div>
            <div class="text-end">
                {% if card.market_url %}
                <a href="{{ card.market_url }}" target="_blank" class="btn btn-success mb-2">
                    <i class="fas fa-external-link-alt"></i> View on TCGPlayer
                </a>
                {% endif %}
                <form method="POST" action="{{ url_for('delete_card', card_id=card.id) }}" class="d-inline">
                    <button type="submit" class="btn btn-danger" 
                            onclick="return confirm('Are you sure you want to delete this card?')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </form>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Current Value</h5>
                        <h3 class="text-success">${{ "%.2f"|format(card.current_price or 0) }}</h3>
                        <small class="text-muted">Per card</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Total Value</h5>
                        <h3 class="text-info">${{ "%.2f"|format(card.total_value or 0) }}</h3>
                        <small class="text-muted">{{ card.quantity }} cards</small>
                    </div>
                </div>
            </div>
        </div>

        <form method="POST" action="{{ url_for('edit_card', card_id=card.id) }}">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="quantity" name="quantity" 
                               value="{{ card.quantity }}" min="0" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="condition" class="form-label">Condition</label>
                        <select class="form-select" id="condition" name="condition">
                            <option value="Mint" {{ 'selected' if card.condition == 'Mint' }}>Mint</option>
                            <option value="Near Mint" {{ 'selected' if card.condition == 'Near Mint' }}>Near Mint</option>
                            <option value="Excellent" {{ 'selected' if card.condition == 'Excellent' }}>Excellent</option>
                            <option value="Good" {{ 'selected' if card.condition == 'Good' }}>Good</option>
                            <option value="Light Played" {{ 'selected' if card.condition == 'Light Played' }}>Light Played</option>
                            <option value="Played" {{ 'selected' if card.condition == 'Played' }}>Played</option>
                            <option value="Poor" {{ 'selected' if card.condition == 'Poor' }}>Poor</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="purchase_price" class="form-label">Purchase Price</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="purchase_price" name="purchase_price" 
                                   value="{{ card.purchase_price or 0 }}" step="0.01" min="0">
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="alert_threshold" class="form-label">Price Alert Threshold (%)</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="alert_threshold" name="alert_threshold" 
                                   value="{{ card.price_alert_threshold or 0 }}" step="0.1" min="0" max="100">
                            <span class="input-group-text">%</span>
                        </div>
                        <div class="form-text">Get alerts when price changes by this percentage</div>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Changes
                </button>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Inventory
                </a>
            </div>
        </form>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Card Details</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Collector Number:</strong> {{ card.collector_number or 'N/A' }}</p>
                        <p><strong>Language:</strong> {{ card.language or 'English' }}</p>
                        <p><strong>Foil:</strong> {{ 'Yes' if card.is_foil else 'No' }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Price Change:</strong> 
                            {% if card.price_change > 0 %}
                                <span class="text-success">+${{ "%.2f"|format(card.price_change) }}</span>
                            {% elif card.price_change < 0 %}
                                <span class="text-danger">${{ "%.2f"|format(card.price_change) }}</span>
                            {% else %}
                                <span class="text-muted">$0.00</span>
                            {% endif %}
                        </p>
                        <p><strong>Last Updated:</strong> {{ card.last_updated }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const flipBtn = document.getElementById('flipCardBtn');
    const frontImage = document.getElementById('cardImageFront');
    const backImage = document.getElementById('cardImageBack');
    const flipText = document.getElementById('flipText');
    
    if (flipBtn && frontImage && backImage) {
        let showingFront = true;
        
        // Handle flip button click
        flipBtn.addEventListener('click', function() {
            flipCard();
        });
        
        // Handle image click
        frontImage.addEventListener('click', function() {
            flipCard();
        });
        
        backImage.addEventListener('click', function() {
            flipCard();
        });
        
        function flipCard() {
            if (showingFront) {
                // Show back
                frontImage.style.display = 'none';
                backImage.style.display = 'block';
                flipText.textContent = 'Show Front';
                showingFront = false;
            } else {
                // Show front
                backImage.style.display = 'none';
                frontImage.style.display = 'block';
                flipText.textContent = 'Show Back';
                showingFront = true;
            }
            
            // Add flip animation
            const currentImage = showingFront ? frontImage : backImage;
            currentImage.style.transform = 'rotateY(180deg)';
            setTimeout(() => {
                currentImage.style.transform = 'rotateY(0deg)';
            }, 150);
        }
    }
});
</script>

<style>
.card-image-container img {
    transition: transform 0.3s ease;
}

.card-image-container img:hover {
    transform: scale(1.02);
}
</style>

{% endblock %}